{"version":3,"sources":["../../src/component/config.js"],"names":[],"mappings":";;;;;;;;;;;kBAAe,IAAI;;;;oBACF,MAAM;;;;uBACH,SAAS;;;;sBACV,QAAQ;;;;sBACD,YAAY;;AAE/B,SAAS,gBAAgB,CAAC,YAAY,EAAE;AAC7C,gBAAM,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;AACpC,MAAI,KAAK,GAAG,EAAE,CAAC;;;;;;AACf,yBAAwB,YAAY,8HAAE;UAA7B,WAAW;;AAClB,UAAI,QAAQ,GAAG,WAAW,CAAC;AAC3B,UAAI,CAAC,kBAAK,UAAU,CAAC,WAAW,CAAC,EAAE;AACjC,gBAAQ,GAAG,kBAAK,IAAI,eAAO,WAAW,CAAC,CAAC;OACzC;;AAED,+BAAO,gBAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC,WAAW,EAAE,EAAE,CAAC,GAAE,QAAQ,EAAC,oBAAoB,CAAC,CAAC,CAAC;AAC/E,WAAK,GAAG,KAAK,CAAC,MAAM,CAClB,gBAAG,WAAW,CAAC,QAAQ,CAAC,CACrB,MAAM,CAAC,AAAC,IAAI,IAAK,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CACvC,GAAG,CAAC,AAAC,IAAI,IAAK,kBAAK,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAC5C,CAAC;KACH;;;;;;;;;;;;;;;;AACD,SAAO,KAAK,CAAC;CACd;;AAEM,SAAS,SAAS,CAAC,MAAM,EAAE,aAAa,EAAE;AAC/C,MAAI,MAAM,IAAI,IAAI,EAAE,OAAO,EAAE,CAAC;;AAE9B,gBAAM,MAAM,CAAC,MAAM,CAAC,CAAC;;;;;;AACrB,0BAAsB,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,mIAAE;UAAlC,SAAS;;AAChB,YAAM,KAAK,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;AAChC,oBAAM,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AAC7B,YAAM,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,AAAC,WAAW,IAAK;AAC7C,eAAO,aAAa,CAAC,IAAI,CAAC,AAAC,IAAI,IAAK;AAClC,iBAAQ,IAAI,MAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAE;SAC7C,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ;;;;;;;;;;;;;;;;AAED,SAAO,MAAM,CAAC;CACf;;AAEM,SAAS,QAAQ,CAAC,MAAM,EAAE;AAC/B,gBAAM,MAAM,CAAC,MAAM,CAAC,CAAC;AACrB,gBAAM,KAAK,CAAC,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,YAAY,EAAE,+BAA+B,CAAC,CAAC;AAC5E,QAAM,aAAa,GAAG,gBAAgB,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;AAC5D,WAAS,CAAC,MAAM,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;CACzC;;AAEM,MAAM,IAAI,GAAG,qBAAQ,OAAO,CAAC,WAAU,YAAY,EAAE;AAC1D,QAAM,QAAQ,GAAG,kBAAK,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,YAAY,CAAC,CAAC;AACxD,SAAO,IAAI,CAAC,KAAK,EAAC,MAAM,gBAAG,QAAQ,CAAC,QAAQ,EAAE,qBAAQ,MAAM,EAAE,CAAC,CAAA,CAAC,CAAC;CAClE,CAAC,CAAC","file":"config.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport suspend from 'suspend';\nimport assert from 'assert';\nimport {root, check} from '../util.js';\n\nexport function getScenarioFiles(scenarioDirs) {\n  check.array.of.string(scenarioDirs);\n  let files = [];\n  for (let scenarioDir of scenarioDirs) {\n    let fullPath = scenarioDir;\n    if (!path.isAbsolute(scenarioDir)) {\n      fullPath = path.join(root, scenarioDir);\n    }\n    \n    assert(fs.statSync(fullPath).isDirectory(), `${fullPath} is not a directory!`);\n    files = files.concat(\n      fs.readdirSync(fullPath)\n        .filter((item) => /^.*\\.js$/.test(item))\n        .map((item) => path.join(fullPath, item))\n    );\n  }\n  return files;\n}\n\nexport function getGroups(groups, scenarioFiles) {\n  if (groups == null) return {};\n  \n  check.object(groups);\n  for (let groupName of Object.keys(groups)) {\n    const group = groups[groupName];\n    check.array.of.string(group);\n    groups[groupName] = group.map((filePattern) => {\n      return scenarioFiles.find((file) => {\n        return (new RegExp(filePattern).test(file));\n      });\n    });\n  }\n  \n  return groups;\n}\n\nexport function validate(config) {\n  check.object(config);\n  check.array.of.string(config.scenarioDirs, 'Malformed config.scenarioDirs');\n  const scenarioFiles = getScenarioFiles(config.scenarioDirs);\n  getGroups(config.groups, scenarioFiles);\n}\n\nexport const load = suspend.promise(function*(relativePath) {\n  const fullPath = path.join(process.cwd(), relativePath);\n  return JSON.parse(yield fs.readFile(fullPath, suspend.resume()));\n});\n"]}